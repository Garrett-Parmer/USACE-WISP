<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="css/icon-font.css" />
    <link rel="stylesheet" href="css/home_style.css" />

    <title>
      United States Army Corps of Engineers | Water Information Sharing Program
    </title>
  </head>

  <body>
    <header></header>

    <main>
      <script>
        const testLink =
          'https://water.usace.army.mil/a2w/CWMS_CRREL.cwms_data_api.get_loc_summary_json?p_location_id=2063051&p_source=CWMS&p_unit_system=EN&p_format=JSON';
        const damLink =
          'https://water.usace.army.mil/a2w/CWMS_CRREL.cwms_data_api.get_dam_summary_json?p_location_id=2063051&p_unit_system=EN&p_format=JSON';
        const timeseriesLink = "https://water.usace.army.mil/a2w/CWMS_CRREL.cwms_data_api.get_report_json?p_location_id=2063051&p_parameter_type=Flow%3AStor%3APrecip%3AStage%3AElev&p_last=5&p_last_unit=days&p_unit_system=EN&p_format=JSON";

        //declare variables for data we will pull
        var locationID;
        var baseLocationID;
        var latLon;
        var drainageArea;
        var inFlow;
        var outFlow;
        var chanCap;
        var elevation;
        var spillwayCrest;

        class HashTable{
          constructor(){
            this.values = {};
            this.length = 0;
            this.size = 0;
          }

          calculateHash(key){
            return key.toString().length % this.size;
          }

          add(key, value){
            const hash = this.calculateHash(key);
            if (!this.values.hasOwnProperty(hash)){
              this.values[hash] = {};
            }
            if (!this.values[hash].hasOwnProperty(key)) {
              this.length++;
            }
            this.values[hash][key] = value;
            }

            search(key) {
              const hash = this.calculateHash(key);
              if (this.values.hasOwnProperty(hash) && this.values[hash].hasOwnProperty(key)) {
                return this.values[hash][key];
              } else {
                return null;
              }
            }
        }

        fetch(testLink)
          .then((response) => response.json())
          .then((data) => {
            data = JSON.stringify(data);
            data = JSON.parse(data);

            // log each piece of data into variables
            locationID = data[0]['data'][0][0].trim();
            baseLocationID = data[0]['data'][0][1].trim();
            latLon = data[0]['data'][0][2].trim();
            drainageArea = data[0]['data'][0][3].trim();
            inFlow = data[0]['data'][0][4].trim();
            outFlow = data[0]['data'][0][5].trim();
            chanCap = data[0]['data'][0][6].trim();
            elevation = data[0]['data'][0][7].trim();
            spillwayCrest = data[0]['data'][0][8].trim();

            // console.log(
            //   'Current water elevation at',
            //   locationID,
            //   'is',
            //   elevation
            // );
          });

        //declare variables for data we will pull from dam link

        var damElevation;
        var dateAndTime;
        var currentStorage;
        var bottomConservationPool;
        var bottomFlood;
        var bottomNormal;
        var damSpillwayCrest;
        var streambed;
        var topConservationPool;
        var topDam;
        var topFloodControlPool;
        var topInactiveConservation;
        var topNormal;
        var topSurcharge;
        var bottomFloodStorage;
        var bottomNormalStorage;
        var topConservationPoolStorage;
        var topDamStorage;
        var topFloodControlStorage;
        var topInactiveConservationStorage;
        var topSurchargeStorage;
        var office;

        //testing
        //create damData object to store data with its name
        var damData = {
          damElevation: '',
          dateAndTime: '',
          currentStorage: '',
          bottomConservationPool: '',
          bottomFlood: '',
          bottomNormal: '',
          damSpillwayCrest: '',
          streambed: '',
          topConservationPool: '',
          topDam: '',
          topFloodControlPool: '',
          topInactiveConservation: '',
          topNormal: '',
          topSurcharge: '',
          bottomFloodStorage: '',
          bottomNormalStorage: '',
          topConservationPoolStorage: '',
          topDamStorage: '',
          topFloodControlStorage: '',
          topInactiveConservationStorage: '',
          topSurchargeStorage: '',
        };

        fetch(damLink)
          .then((response) => response.json())
          .then((data) => {
            data = JSON.stringify(data);
            data = JSON.parse(data);

            // iterates through object and assigns each key with value(lake data)
            for (let i = 0; i < Object.keys(damData).length; ++i) {
              damData[Object.keys(damData)[i]] = data[0]['data'][i][1];
            }

            //console.log(damData);
          });

          fetch(timeseriesLink)
          .then((response) => response.json())
          .then((data) => {
            data = JSON.stringify(data);
            data = JSON.parse(data);
            const elevationHash = new HashTable();


            for (let i = 0; i < data[0]["Elev"].length; ++i) {
                //console.log(data[0]["Elev"][i]);
                elevationHash.add(data[0]["Elev"][i]["time"], data[0]["Elev"][i]["value"]);

            }

            console.log(elevationHash.search("14-Mar-2023 10:00:00"))

            

            //console.log(damData);
          });


      </script>
    </main>
  </body>
</html>
